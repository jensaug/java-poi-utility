{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "definitions": {
        "naturalKey": {
            "type": "object",
            "properties": {
                "process": {
                    "type": "object",
                    "properties": {
                        "name": {
                            "type": "string"
                        },
                        "parentState": {
                            "type": "string"
                        }
                    },
                    "additionalProperties": false,
                    "required": ["name", "parentState"]
                },
                "dn": {
                    "type": "string"
                }
            },
            "required": ["process", "dn"]
        },
        "measurement": {
            "type": "object",
            "properties": {
                "name": {
                    "type": "string"
                },
                "grouping": {
                    "type": "string"
                },
                "period": {
                    "type": "string"
                }
            },
            "additionalProperties": false,
            "required": ["name", "grouping", "period"]
        }
    },
    "type": "object",
    "allOf": [
        {
            "$ref": "#/definitions/naturalKey"
        },
        {
            "properties": {
                "_id": {
                    "id": "_id",
                    "type": "string"
                },   
                "hsaId": {
                    "type": "string"
                },                
                "measurement": {
                    "type": "object",
                    "properties": {
                        "/": {
                            "$ref": "#/definitions/measurement"
                        }
                    }
                },
                "open": {
                    "type": "string"
                },
                "close": {
                    "type": "string"
                },
                "currentState": {
                    "type": "string"
                },
                "created": {
                    "type": "string"
                }
            }
            }
        ],
    "properties": {
        "_id" : {},        
        "process": {},
        "hsaId": {},
        "dn": {},
        "measurement": {},
        "open": {},
        "close": {},
        "currentState": {},
        "created": {}
    },
    "additionalProperties": false,
    "required": ["process", "dn", "measurement", "currentState"]
}